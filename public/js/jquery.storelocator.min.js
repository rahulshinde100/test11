/*
* storeLocator v1.4.6 - jQuery Google Maps Store Locator Plugin
* (c) Copyright 2013, Bjorn Holine (http://www.bjornblog.com)
* Released under the MIT license
* Distance calculation function by Chris Pietschmann: http://pietschsoft.com/post/2008/02/01/Calculate-Distance-Between-Geocodes-in-C-and-JavaScript.aspx
*/

(function(a){a.fn.storeLocator=function(b){var c=a.extend({mapDiv:"map",listDiv:"loc-list",formContainerDiv:"form-container",formID:"user-location",inputID:"address",zoomLevel:12,pinColor:"fe7569",pinTextColor:"000000",lengthUnit:"m",storeLimit:26,distanceAlert:60,dataType:"xml",dataLocation:"locations.xml",listColor1:"ffffff",listColor2:"eeeeee",originMarker:false,originpinColor:"blue",bounceMarker:true,slideMap:true,modalWindow:false,overlayDiv:"overlay",modalWindowDiv:"modal-window",modalContentDiv:"modal-content",modalCloseIconDiv:"close-icon",defaultLoc:false,defaultLat:"",defaultLng:"",autoGeocode:false,maxDistance:false,maxDistanceID:"maxdistance",fullMapStart:false,noForm:false,loading:false,loadingDiv:"loading-map",infowindowTemplatePath:"templates/infowindow-description.html",listTemplatePath:"templates/location-list-description.html",KMLinfowindowTemplatePath:"templates/kml-infowindow-description.html",KMLlistTemplatePath:"templates/kml-location-list-description.html",callbackBeforeSend:null,callbackComplete:null,callbackSuccess:null,callbackModalOpen:null,callbackModalClose:null,jsonpCallback:null,geocodeErrorAlert:"Geocode was not successful for the following reason: ",blankInputAlert:"The input box was blank.",addressErrorAlert:"Unable to find address",autoGeocodeErrorAlert:"Automatic location detection failed. Please fill in your address or zip code.",distanceErrorAlert:"Unfortunately, our closest location is more than ",mileLang:"mile",milesLang:"miles",kilometerLang:"kilometer",kilometersLang:"kilometers"},b);
return this.each(function(){var h=a(this);var e,g;f();function f(){if(c.dataType==="kml"){a.get(c.KMLinfowindowTemplatePath,function(i){var j=i;g=Handlebars.compile(j);
});a.get(c.KMLlistTemplatePath,function(i){var j=i;e=Handlebars.compile(j);d();});}else{a.get(c.infowindowTemplatePath,function(i){var j=i;g=Handlebars.compile(j);
});a.get(c.listTemplatePath,function(i){var j=i;e=Handlebars.compile(j);d();});}}function d(){var i,y,s,m,B,k;var p=[];var x=[];var v="storeLocator";function z(){p=[];
x=[];a(document).off("click."+v,"#"+c.listDiv+" li");}if(c.modalWindow===true){h.wrap('<div id="'+c.overlayDiv+'"><div id="'+c.modalWindowDiv+'"><div id="'+c.modalContentDiv+'">');
a("#"+c.modalWindowDiv).prepend('<div id="'+c.modalCloseIconDiv+'"></div>');a("#"+c.overlayDiv).hide();}if(c.slideMap===true){h.hide();}var j={};if(c.lengthUnit==="km"){j.EarthRadius=6367;
}else{j.EarthRadius=3956;}j.ToRadian=function(r){return r*(Math.PI/180);};j.DiffRadian=function(D,r){return j.ToRadian(r)-j.ToRadian(D);};j.CalcDistance=function(G,F,E,D,r){return r*2*Math.asin(Math.min(1,Math.sqrt((Math.pow(Math.sin((j.DiffRadian(G,E))/2),2)+Math.cos(j.ToRadian(G))*Math.cos(j.ToRadian(E))*Math.pow(Math.sin((j.DiffRadian(F,D))/2),2)))));
};function w(){geocoder=new google.maps.Geocoder();this.geocode=function(r,D){geocoder.geocode({address:r},function(G,F){if(F==google.maps.GeocoderStatus.OK){var E={};
E.latitude=G[0].geometry.location.lat();E.longitude=G[0].geometry.location.lng();D(E);}else{alert(c.geocodeErrorAlert+F);D(null);}});};}function C(){geocoder=new google.maps.Geocoder();
this.geocode=function(D,r){geocoder.geocode({latLng:D},function(G,F){if(F==google.maps.GeocoderStatus.OK){if(G[0]){var E={};E.address=G[0].formatted_address;
r(E);}}else{alert(c.geocodeErrorAlert+F);r(null);}});};}function t(r,D){return Math.round(r*Math.pow(10,D))/Math.pow(10,D);}if(c.defaultLoc===true){var u=new C();
var n=new google.maps.LatLng(c.defaultLat,c.defaultLng);u.geocode(n,function(D){if(D!==null){var r=D.address;o(c.defaultLat,c.defaultLng,r);}else{alert(c.addressErrorAlert);
}});}if(c.fullMapStart===true){o();}if(c.autoGeocode===true){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(q,A);}}function q(D){var E=new C();
var F=new google.maps.LatLng(D.coords.latitude,D.coords.longitude);E.geocode(F,function(G){if(G!==null){var r=G.address;o(D.coords.latitude,D.coords.longitude,r);
}else{alert(c.addressErrorAlert);}});}function A(r){alert(c.autoGeocodeErrorAlert);}function l(F){var E=a("#"+c.inputID).val();if(E===""){alert(c.blankInputAlert);
}else{var D=new w();var r=E;D.geocode(r,function(G){if(G!==null){y=G.latitude;s=G.longitude;o(y,s,E,F);}else{alert(c.addressErrorAlert);}});}}a(function(){function r(E){E.preventDefault();
if(c.maxDistance===true){var D=a("#"+c.maxDistanceID).val();l(D);}else{l();}}if(c.noForm===true){a(document).on("click."+v,"#"+c.formContainerDiv+" #submit",function(D){r(D);
});a(document).on("keyup."+v,function(D){if(D.keyCode===13){r(D);}});}else{a(document).on("submit."+v,"#"+c.formID,function(D){r(D);});}});function o(r,E,D,F){a(function(){var G;
if(c.dataType==="kml"){G="xml";}else{G=c.dataType;}a.ajax({type:"GET",url:c.dataLocation+(c.dataType==="jsonp"?(c.dataLocation.match(/\?/)?"&":"?")+"callback=?":""),dataType:G,jsonpCallback:(c.dataType==="jsonp"?c.jsonpCallback:null),beforeSend:function(){if(c.callbackBeforeSend){c.callbackBeforeSend.call(this);
}if(c.loading===true){a("#"+c.formContainerDiv).append('<div id="'+c.loadingDiv+'"></div>');}},complete:function(J,I,H){if(c.callbackComplete){c.callbackComplete.call(this,J,I,H);
}if(c.loading===true){a("#"+c.loadingDiv).remove();}},success:function(J,L,H){if(c.callbackSuccess){c.callbackSuccess.call(this,J,L,H);}var I=0;var K;if(c.fullMapStart===true&&a("#"+c.mapDiv).hasClass("mapOpen")===false){K=true;
}else{z();}a("#"+c.mapDiv).addClass("mapOpen");if(c.dataType==="json"||c.dataType==="jsonp"){a.each(J,function(){var Q=this.locname;var ab=this.lat;var ac=this.lng;
var ad=this.address;var P=this.address2;var W=this.city;var O=this.state;var Y=this.postal;var S=this.country;var Z=this.phone;var aa=this.email;var X=this.web;
X=X.replace("http://","");var V=this.hours1;var U=this.hours2;var T=this.hours3;var R=this.category;var N=j.CalcDistance(r,E,ab,ac,j.EarthRadius);if(c.maxDistance===true&&K!==true){if(N<F){p[I]=[N,Q,ab,ac,ad,P,W,O,Y,S,Z,aa,X,V,U,T,R];
}else{return;}}else{p[I]=[N,Q,ab,ac,ad,P,W,O,Y,S,Z,aa,X,V,U,T,R];}I++;});}else{if(c.dataType==="kml"){a(J).find("Placemark").each(function(){var O=a(this).find("name").text();
var Q=a(this).find("coordinates").text().split(",")[1];var N=a(this).find("coordinates").text().split(",")[0];var P=a(this).find("description").text();
var R=j.CalcDistance(r,E,Q,N,j.EarthRadius);if(c.maxDistance===true&&K!==true){if(R<F){p[I]=[R,O,Q,N,P];}else{return;}}else{p[I]=[R,O,Q,N,P];}I++;});}else{a(J).find("marker").each(function(){var Q=a(this).attr("name");
var ab=a(this).attr("lat");var ac=a(this).attr("lng");var ad=a(this).attr("address");var P=a(this).attr("address2");var W=a(this).attr("city");var O=a(this).attr("state");
var Y=a(this).attr("postal");var S=a(this).attr("country");var Z=a(this).attr("phone");var aa=a(this).attr("email");var X=a(this).attr("web");X=X.replace("http://","");
var V=a(this).attr("hours1");var U=a(this).attr("hours2");var T=a(this).attr("hours3");var R=a(this).attr("category");var N=j.CalcDistance(r,E,ab,ac,j.EarthRadius);
if(c.maxDistance===true&&K!==true){if(N<F){p[I]=[N,Q,ab,ac,ad,P,W,O,Y,S,Z,aa,X,V,U,T,R];}else{return;}}else{p[I]=[N,Q,ab,ac,ad,P,W,O,Y,S,Z,aa,X,V,U,T,R];
}I++;});}}p.sort(function(P,O){var N=P[0];var Q=O[0];return((N<Q)?-1:((N>Q)?1:0));});var M=(c.lengthUnit==="km")?c.kilometersLang:c.milesLang;if(c.maxDistance===true&&K!==true){if(p[0]===undefined||p[0][0]>F){alert(c.distanceErrorAlert+F+" "+M);
return;}}else{if(p[0][0]>c.distanceAlert){alert(c.distanceErrorAlert+c.distanceAlert+" "+M);}}a(function(){var au,am,ak,ai,W,ap,X,O,aq,P,Y,ag,ae,ad,ao,ah;
function Z(av){au=p[av][0];au=t(au,2);am=p[av][1];ak=p[av][4];ai=p[av][5];W=p[av][6];ap=p[av][7];O=p[av][8];X=p[av][9];aq=p[av][10];P=p[av][11];Y=p[av][12];
ag=p[av][13];ae=p[av][14];ad=p[av][15];ah=p[av][16];}function ab(av){au=p[av][0];au=t(au,2);am=p[av][1];ao=p[av][4];}function R(az){if(c.dataType==="kml"){ab(az.get("id"));
}else{Z(az.get("id"));}var ax;if(au<=1){if(c.lengthUnit==="km"){ax=c.kilometerLang;}else{ax=c.mileLang;}}else{if(c.lengthUnit==="km"){ax=c.kilometersLang;
}else{ax=c.milesLang;}}var ay=az.get("id");if(c.storeLimit>26){var aw=ay+1;}else{var aw=String.fromCharCode("A".charCodeAt(0)+ay);}if(c.dataType==="kml"){var av={location:[{distance:au,markerid:ay,marker:aw,name:am,description:ao,length:ax,origin:D}]};
}else{var av={location:[{distance:au,markerid:ay,marker:aw,name:am,address:ak,address2:ai,city:W,state:ap,postal:O,country:X,phone:aq,email:P,web:Y,hours1:ag,hours2:ae,hours3:ad,length:ax,origin:D,category:ah}]};
}return av;}if(c.slideMap===true){h.slideDown();}if(c.modalWindow===true){if(c.callbackModalOpen){c.callbackModalOpen.call(this);}function Q(){if(c.callbackModalOpen){c.callbackModalOpen.call(this);
}a("#"+c.overlayDiv).hide();}a("#"+c.overlayDiv).fadeIn();a(document).on("click."+v,"#"+c.modalCloseIconDiv+", #"+c.overlayDiv,function(){Q();});a(document).on("click."+v,"#"+c.modalWindowDiv,function(av){av.stopPropagation();
});a(document).on("keyup."+v,function(av){if(av.keyCode===27){Q();}});}if((c.fullMapStart===true&&K===true)||c.zoomLevel===0){var aj={mapTypeId:google.maps.MapTypeId.ROADMAP};
var U=new google.maps.LatLngBounds();}else{var aj={zoom:c.zoomLevel,center:new google.maps.LatLng(r,E),mapTypeId:google.maps.MapTypeId.ROADMAP};}var ar=new google.maps.Map(document.getElementById(c.mapDiv),aj);
var ac=new google.maps.InfoWindow();if((p.length-1)<c.storeLimit-1){k=p.length-1;}else{k=c.storeLimit-1;}if(c.originMarker===true&&c.fullMapStart===false){var T=new google.maps.MarkerImage("//chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
var af=new google.maps.LatLng(r,E);var V=new google.maps.Marker({position:af,map:ar,icon:"//maps.google.com/mapfiles/ms/icons/"+c.originpinColor+"-dot.png",shadow:T,draggable:false});
}for(var aa=0;aa<=k;aa++){var at=String.fromCharCode("A".charCodeAt(0)+aa);var an=new google.maps.LatLng(p[aa][2],p[aa][3]);V=N(an,p[aa][1],p[aa][4],at,p[aa][14]);
V.set("id",aa);x[aa]=V;if((c.fullMapStart===true&&K===true)||c.zoomLevel===0){U.extend(an);}S(V);}if((c.fullMapStart===true&&K===true)||c.zoomLevel===0){ar.fitBounds(U);
}a("#"+c.listDiv+" ul").empty();a(x).each(function(av,aw){var ax=String.fromCharCode("A".charCodeAt(0)+av);var ay=x[av];al(ay);});function al(aw){var av=R(aw);
var ax=e(av);a("#"+c.listDiv+" ul").append(ax);}a(document).on("click."+v,"#"+c.listDiv+" li",function(){var ax=a(this).data("markerid");var aw=x[ax];a("#"+c.listDiv+" li").removeClass("list-focus");
a("#"+c.listDiv+" li[data-markerid="+ax+"]").addClass("list-focus");ar.panTo(aw.getPosition());var av="left";if(c.bounceMarker===true){aw.setAnimation(google.maps.Animation.BOUNCE);
setTimeout(function(){aw.setAnimation(null);S(aw,av);},700);}else{S(aw,av);}});a("#"+c.listDiv+" ul li:even").css("background","#"+c.listColor1);a("#"+c.listDiv+" ul li:odd").css("background","#"+c.listColor2);
function N(av,ay,ax,aC,aA){var aB=new google.maps.MarkerImage("//chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+aC+"|"+c.pinColor+"|"+c.pinTextColor,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));
var az=new google.maps.MarkerImage("//chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
if(c.storeLimit>26){var aw=new google.maps.Marker({position:av,map:ar,draggable:false});}else{var aw=new google.maps.Marker({position:av,map:ar,icon:aB,shadow:az,draggable:false});
}return aw;}function S(ay,ax){var aw=R(ay);var av=g(aw);if(ax==="left"){ac.setContent(av);ac.open(ay.get("map"),ay);}else{google.maps.event.addListener(ay,"click",function(){ac.setContent(av);
ac.open(ay.get("map"),ay);a("#"+c.listDiv+" li").removeClass("list-focus");markerId=ay.get("id");a("#"+c.listDiv+" li[data-markerid="+markerId+"]").addClass("list-focus");
var az=a("#"+c.listDiv),aA=a("#"+c.listDiv+" li[data-markerid="+markerId+"]");a("#"+c.listDiv).animate({scrollTop:aA.offset().top-az.offset().top+az.scrollTop()});
});}}});}});});}}});};})(jQuery);